



è¿™æ˜¯ç¬¬ä¸‰ç‰ˆçš„ç¬”è®°



- > ç¬¬å››ç‰ˆåªæ”¯æŒVue3 â€”â€” [ç¬¬å››ç‰ˆä»“åº“](https://github.com/vuejs/vue-router-next)

- å˜é‡åæ„ä¹‰

  - `VueRouter`  
    vue-routerçš„node_moduleåŒ…å¯¼å‡ºçš„å˜é‡

    - å¯¼å…¥æ–¹å¼  

      ```js
      import VueRouter from "vue-router"
      ```

      





# åŸºç¡€

å·¥ç¨‹åŒ–çš„å®Œæ•´ä¾‹å­å¦‚ä¸‹

```js
import Vue from "vue"
import VueRouter from "vue-router"
Vue.use(VueRouter)

const router=new VueRouter({
  routes:[
    { 
      name:'xx',
      path: '/dd',
      component: { template: '<div>foo</div>' } 
    },
  ]
})

new Vue({
    // å…¶ä»–å†…å®¹
    router,
}).$mount('#app')
```

ç„¶ååœ¨`<router-view></router-view>`å†…å°±å¯ä»¥æ¸²æŸ“è·¯ç”±äº†



- vue-routerç›´æ¥å¼•å…¥ä¸æ”¯æŒie9ï¼Œä¸è¿‡å¬è¯´ç”¨å·¥ç¨‹åŒ–çš„æ–¹æ³•ä½¿ç”¨çš„è¯æ˜¯æ”¯æŒçš„

- è®©vue-routerç”Ÿæ•ˆæ–¹æ³•  
  å°†å…¶htmléƒ¨åˆ†åŒ…è£¹åœ¨ä¸€ä¸ªæ ‡ç­¾å†…ï¼Œå¹¶å°†è¯¥æ ‡ç­¾æŒ‚è½½ã€‚æŒ‚è½½ä¾‹å­ï¼š  

  ```javascript
  new Vue({
      router //è¿™ä¸ªæ˜¯routerå®ä¾‹
  }).$mount('#app')
  ```






### å®šä¹‰è·¯ç”±
```javascript
const routes = [
    { 
        name:'xx',
        path: '/dd',
        component: { template: '<div>foo</div>' } 
    },
]
```
- `name`å€¼å¯ä»¥å¸¦`.`å¸¦æ•°å­—
- `path`çš„å€¼æ˜¯è·¯ç”±  
  é‡Œè¾¹å¯ä»¥å¸¦`.`å¸¦æ•°å­—
- `component`çš„å€¼æ˜¯ç»„ä»¶

### åˆ›å»º router å®ä¾‹
```javascript
const router = new VueRouter({
    routes
})
```





### [`router-link`](https://router.vuejs.org/zh/api/#router-link)

- `router-link`æ ‡ç­¾ä¸­toå±æ€§çš„å€¼ä»£è¡¨è·¯ç”±ï¼ˆè·³è½¬åˆ°çš„ç»„ä»¶ï¼‰
  - toä¼ å…¥å­—ç¬¦ä¸²æ—¶  
    å¿…é¡»ä»¥/å¼€å¤´ä¸”ä¸èƒ½ä»¥/ç»“å°¾
  - toä¼ å…¥å¯¹è±¡æ—¶  
    å¯¹è±¡å’Œ`router.push()`é‡Œçš„ä¸€è‡´
- `router-link`è¦åŠ ç‚¹å‡»äº‹ä»¶çš„è¯è¦å†™`@click.native`ï¼Œè€Œä¸”ç›´æ¥å†™è¯­å¥çš„è¯å°±ç®—åŠ äº†ç®­å¤´å‡½æ•°ä¹Ÿæ˜¯æ²¡æœ‰this
- æ¸²æŸ“æ ‡ç­¾  
  é»˜è®¤ä¼šè¢«æ¸²æŸ“ä¸ºaæ ‡ç­¾  
  è¦ä¿®æ”¹æ¸²æŸ“çš„æ ‡ç­¾çš„è¯è¦ç”¨[tagå±æ€§](https://router.vuejs.org/zh/api/#tag)  
  <span style='opacity:.5'>ï¼ˆæé†’ï¼šç”¨isä¸è¡Œï¼Œç”¨isçš„è¯å°±å·²ç»ä¸æ˜¯`router-link`æ ‡ç­¾äº†ï¼‰</span>  
  <span style='opacity:.5'>ï¼ˆç”¨tagçš„è¯æ§åˆ¶å°ä¼šæç¤ºvue-router4ä¸æ”¯æŒï¼‰</span>





### `router-view`

`router-view`æœ¬èº«ä¸ä¼šæ¸²æŸ“å‡ºä¸€ä¸ªæ ‡ç­¾ï¼Œåªä¼šåœ¨`router-view`çš„ä½å­æ¸²æŸ“å‡ºéœ€è¦çš„å†…å®¹  

`router-view`æ ‡ç­¾ä¸Šé™¤äº†nameå±æ€§å¤–æ‰€æœ‰å±æ€§éƒ½ä¼šä¼ é€’åˆ°æ¸²æŸ“å‡ºæ¥çš„æ ¹æ ‡ç­¾ä¸Šã€‚  

- `router-view`æ ‡ç­¾å«å‡ºå£ï¼Œè·¯ç”±åŒ¹é…åˆ°çš„ç»„ä»¶å°†æ¸²æŸ“åœ¨é‡Œï¼Œå¯ä»¥åœ¨ç»„ä»¶æ¨¡æ¿ä¸­ä½¿ç”¨ã€‚

### `router-view`çš„`name`å±æ€§

nameå±æ€§ç›¸å½“ä¸vueçš„keyå±æ€§ï¼Œç”¨æ¥æ ‡è¯†æ¯ä¸ªå‡ºå£çš„ä¸åŒã€‚å¯¹äºä½¿ç”¨nameçš„router-viewï¼Œå°†ä¸ä¼šä½œä¸ºcomponentçš„å‡ºå£ï¼Œä¹Ÿä¸ä¼šä½œä¸ºcomponents.defaultçš„å‡ºå£ã€‚
è¦æƒ³å‡ºå£æ¸²æŸ“åˆ°æœ‰nameçš„router-viewä¸Šï¼Œroutesä¸­åº”è¯¥ç”¨componentsä»£æ›¿componentï¼Œå¦‚æœä¸¤ä¸ªå¯¹è±¡åŒæ—¶å­˜åœ¨ï¼Œåªä¼šæ¸²æŸ“componentsã€‚
componentsçš„å±æ€§åä¸router-viewçš„nameå±æ€§å€¼å¯¹åº”ï¼Œå¯¹äºæ²¡æœ‰nameçš„router-viewï¼Œå¯¹åº”åˆ°componentsä¸­çš„å±æ€§åä¸ºdefaultã€‚
å¯¹äºnameå±æ€§å€¼æ²¡è¢«åŒ…å«äºå½“å‰è·¯ç”±componentsçš„å±æ€§åä¸­çš„router-viewï¼Œä¸ä¼šæ¸²æŸ“ã€‚













### Historyæ¨¡å¼

> è¿™ç§æ¨¡å¼è¦ç©å¥½ï¼Œè¿˜éœ€è¦åå°é…ç½®æ”¯æŒ â€”â€” [ç¬¬ä¸‰ç‰ˆæ–‡æ¡£](https://router.vuejs.org/zh/guide/essentials/history-mode.html#%E5%90%8E%E7%AB%AF%E9%85%8D%E7%BD%AE%E4%BE%8B%E5%AD%90)

new VueRouter({})ä¸­åŠ å…¥ mode:'history' å¼€å¯Historyæ¨¡å¼
wbæµ‹è¯•ä¸­ä¼šè®©urlä¸­htmlæ–‡ä»¶çš„ç›˜ç¬¦æ¶ˆå¤±ï¼Œå¹¶ä¸”å»æ‰urlä¸­vue-routeréƒ¨åˆ†çš„å¼€å¤´äº•å·
ã€å¹¶æœªç†è§£ä½œç”¨ã€‘ï¼ˆä¼¼ä¹æ˜¯ï¼š1ã€è®©ç›´æ¥å†™urlå¯ä»¥è®¿é—®  2ã€è®©urlçœ‹èµ·æ¥åƒæ­£å¸¸çš„urlã€‚  å…¶ä¸­ç¬¬ä¸€ç‚¹æ²¡æµ‹è¯•æˆåŠŸè¿‡ï¼Œå¯èƒ½è¦åç«¯æŠ€æœ¯æ”¯æŒã€‚ç¬¬äºŒç‚¹é™¤äº†å»æ‰ç›˜ç¬¦ã€äº•å·å¹¶æ²¡æœ‰å‘ç°å…¶ä»–ä¼˜åŒ–ã€‚ï¼‰
historyæ¨¡å¼çš„ç½‘é¡µåªèƒ½åœ¨httpæœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œç›´æ¥åŒå‡»htmlæ–‡ä»¶çš„è¯ä¼šå¯¼è‡´ï¼š
    1. è·¯ç”±åé™¤äº†é’©å­ï¼ˆå·²æµ‹è¯•mountedï¼‰å¤–ä»€ä¹ˆéƒ½æ‰¾ä¸åˆ°
        2. æ‰€æœ‰å›¾ç‰‡ã€å­—ä½“æ–‡ä»¶éƒ½æ‰¾ä¸åˆ°
       ä¸æ”¾åœ¨httpæœåŠ¡å™¨æ›´ç›®å½•ä¸Šçš„è¯ï¼Œè¿™äº›èµ„æºä¸€æ ·æ‰¾ä¸åˆ°ï¼Œä¸è¿‡è·¯ç”±å¯ç”¨ï¼Œä½†æ˜¯è·¯ç”±åˆ°â€œ/â€æ—¶ï¼Œæµè§ˆå™¨urlæ æ˜¾ç¤ºçš„ä¼šå˜æˆæœåŠ¡å™¨åº•å±‚åœ°å€ï¼Œé™¤æ­¤å¤–æ²¡æœ‰å…¶ä»–æ¯›ç—…
       æœåŠ¡å™¨ä¸Šçš„å›¾ç‰‡ã€å­—ä½“èµ„æºéƒ½æ˜¯å»åº•å±‚ç›®å½•ä¸Šæ‰¾





# æ•°æ®è·å–

å®˜æ–¹é¡µé¢è¿™ä¸ªç« èŠ‚å®Œå…¨çœ‹ä¸æ‡‚ï¼ˆjséƒ¨åˆ†ï¼‰







ä¸‹é¢è®°å½•çš„å†…å®¹æ¥æºä¸æ˜¯å®˜æ–¹é¡µé¢

- è·å¾—å½“å‰è·¯ç”±ä¿¡æ¯  
  é€šè¿‡`vueç»„ä»¶å®ä¾‹.$route`å¯ä»¥è·å¾—  
  æœ‰å¾ˆå¤šä¿¡æ¯ï¼ŒåŒ…æ‹¬paramsã€metaç­‰  
  ï¼ˆæœ¬ç¬”è®°çš„ã€ŠåŠ¨æ€è·¯å¾„å‚æ•°ã€‹éƒ¨åˆ†ä¹Ÿæœ‰ç±»ä¼¼ç”¨æ³•ï¼‰







### è·¯ç”±ä¿¡æ¯å¯¹è±¡çš„å±æ€§

ï¼ˆè¿™é‡Œè¯´çš„è·¯å¾„éƒ½æ˜¯é¡µé¢åœ°å€åŠ äº•å·åé¢éƒ¨åˆ†çš„urlåœ°å€ï¼‰
ï¼ˆåœ¨å®ä¾‹ä¸­ä½¿ç”¨æ—¶è®°å¾—åœ¨å‰é¢åŠ ä¸Šâ€œthis.â€ï¼‰

- `$route.hash`  
  hashå€¼ï¼Œè·¯ç”±ä¸­#åŠå…¶ä»¥åéƒ¨åˆ†ã€‚å¦‚æœè·¯ç”±ä»¥#å¼€å¤´çš„è¯ï¼Œè¿™ç§è·¯ç”±çš„urlå°±æ˜¯å‰ä¸€ä¸ªurlååŠ ä¸Šhashå€¼ï¼Œå¹¶ä¸”è¿™ä¸€æ¬¡è·¯ç”±åªä¼šç»™ä¸Šä¸€æ¬¡çš„è·¯ç”±æ›´æ–°hashå€¼ï¼ˆpathä¸­æ— æ³•å†™hashï¼Œä½†æ˜¯ä¸å½±å“å¯¹hashçš„æ•è·ï¼‰ã€‚
- `$route.query`  
  - åœ¨è·¯å¾„ä¸­åŠ å…¥çš„ â€œ?xx=123â€ å«æŸ¥è¯¢å‚æ•°  
    æŸ¥è¯¢å‚æ•°ä¸€å®šè¦å†™åœ¨hashå€¼çš„å‰é¢
  - $route.queryä¼šè¿”å› â€œ{"xx":"123"}â€   
    å†™$route.query.xxåˆ™ä¼šè¿”å›123ã€‚
- `$route.path`  
  ä¸å«hashå€¼å’ŒæŸ¥è¯¢å‚æ•°çš„è·¯å¾„ã€‚
- `$route.fullPath`  
  åŒ…å«æŸ¥è¯¢å‚æ•°å’Œ hash çš„å®Œæ•´è·¯å¾„ã€‚
- `$route.matched`  
  ä¸€ä¸ªæ•°ç»„ï¼Œå½“å‰è·¯ç”±çš„ è·¯ç”±è®°å½•ï¼ˆroutes é…ç½®æ•°ç»„ä¸­çš„å¯¹è±¡å‰¯æœ¬ï¼‰
- `$route.name`  
  routesä¸­ä¸pathåŒçº§çš„nameå±æ€§çš„å±æ€§å€¼ã€‚















# è·¯ç”±æ•°æ®æè¿°



queryä¸paramsä¸åŒçš„åœ°æ–¹

- queryæ˜¯åœ¨è·¯ç”±ä¸­è¾“å…¥åå€¼å¯¹ä¸­çš„åï¼Œè€Œparamsåªèƒ½åœ¨routesä¸­è¾“å…¥åï¼Ÿï¼Ÿï¼Ÿ



### param  

å¦‚æœä¸€ä¸ªpathæ˜¯è¿™æ ·çš„`'xxx/:id/:type'`ï¼Œé‚£idå’Œtypeå°±æ˜¯param

- å¯ä»¥é€šè¿‡`this.$route.params.id`ã€`this.$route.params.type`è®¿é—®

- $router.pushçš„2ç§å†™æ³•

  - pathç›´æ¥å®Œæ•´åœ°æ‹¼å‡ºæ¥  
    æ¯”å¦‚ï¼š

    ```js
    this.$router.push({
      path: `/xxx/123/edit`
    })
    ```

  - name+å¯¹è±¡å½¢å¼çš„params

  - ä¸‹é¢è¿™ç§å†™æ³•æ˜¯ä¸è¡Œçš„  

    ```js
    this.$router.push({
      path: `/xxx/:id/:type`,
      params: {
        id:123,
        type:'edit',
      },
    })
    ```

    

### åŠ¨æ€è·¯å¾„å‚æ•°

```javascript
const router = new VueRouter({
    routes: [
        {path: '/user/:xx', component:{
        	template: '<div>{{ $route.params.xx }}</div>'
        }}
    ]
})
```

é‡åˆ°æ‰€æœ‰ â€œ/user/:xxâ€ çš„è·¯ç”±ï¼Œéƒ½ä¼šåœ¨{{}}ä¸­æ¸²æŸ“å‡º xxã€‚

- å¯ä»¥è®¾ç½®å¤šä¸ª åŠ¨æ€è·¯å¾„å‚æ•°
  - ä¸­é—´å¯ä»¥æœ‰ä»»ä½•é—´éš”
  - ä¹Ÿå¯ä»¥æ²¡æœ‰é—´éš”  
    æ²¡æœ‰é—´éš”çš„è¯é™¤äº†æœ€åä¸€ä¸ª åŠ¨æ€è·¯å¾„å‚æ•° ä»¥å¤–å…¶ä»– åŠ¨æ€è·¯å¾„å‚æ•° éƒ½åªå–ä¸€ä¸ªå­—ç¬¦ï¼ˆï¼Ÿï¼Ÿï¼Ÿï¼‰





### åµŒå¥—è·¯ç”±

åœ¨VueRouterçš„å‚æ•°ä¸­ä½¿ç”¨childrené…ç½®ï¼Œchildrenå€¼ä¸routeså®Œå…¨ä¸€è‡´ã€‚
å¦‚æœå¸Œæœ›å­åµŒå¥—çš„è·¯ç”±æ˜¯è·Ÿåœ¨çˆ¶åµŒå¥—åé¢çš„è¯é‚£pathæ— éœ€åŠ /ï¼Œå¦‚æœå¸Œæœ›å­åµŒå¥—è·¯ç”±å°±æ˜¯pathå€¼çš„è¯ï¼Œå°±è¦åŠ ä¸Š/ã€‚
æ— è®ºpathåŠ ä¸åŠ /ï¼Œé¡µé¢å‘ˆç°éƒ½æ˜¯ä¸€æ ·çš„ï¼Œéƒ½ä¼šæ¸²æŸ“å‡ºçˆ¶è·¯ç”±çš„templateï¼Œå†ä»çˆ¶è·¯ç”±templateçš„router-viewä¸­æ¸²æŸ“å‡ºå­è·¯ç”±ã€‚
ä»¥ä¸Šä¸¤æ¡é€‚ç”¨ä¸æ‰€æœ‰ä¸pathåŒçº§çš„è·¯ç”±å±æ€§ï¼ˆå·²éªŒè¯ï¼šé‡å®šå‘redirectã€åˆ«åaliasã€ç›®å‰åªå­¦äº†è¿™ä¸¤ä¸ªã€‘ï¼‰





### é‡å®šå‘

routesçš„redirectå±æ€§

- å€¼è¦æ±‚æ˜¯å¦ä¸€ä¸ªpathçš„å€¼

- å‘èµ·åŸpathè·¯ç”±åæ•ˆæœå°†å®Œå…¨å’Œå‘èµ·redirectä¸­pathä¸€æ ·

- å¦‚æœé‡å®šå‘ä¸æ˜¯ä¾èµ–hashæˆ–è€…queryçš„è¯ï¼Œå®šå‘å‰çš„hashæˆ–è€…queryä¼šä¿ç•™åˆ°å®šå‘åã€‚

- ä¹Ÿå¯ä»¥ç”¨nameé‡å®šå‘  
  ä¾‹å­ï¼š `redirect: { name: 'foo' } `

- æ ¹æ®paramsé‡å®šå‘ï¼š  
  `path: '/aa/:xx', redirect: '/bb/:xx'`

- ä¸ºæ‰€æœ‰ä¸å­˜åœ¨äºroutesä¸­çš„è·¯ç”±é‡å®šå‘ï¼š  
  `path: '*', redirect: '/foo'`  
  ï¼ˆå»æ‰redirectï¼ŒåŠ ä¸Šcomponentçš„è¯ï¼Œèƒ½å°†ä¸å­˜åœ¨çš„è·¯ç”±æ¸²æŸ“å‡ºä¸œè¥¿ï¼‰

- åŠ¨æ€è¿”å›é‡å®šå‘ç›®æ ‡  
  æ ¼å¼ï¼š

  ```js
  path: '/xxx/:id?',
  redirect: to => {
      const { hash, params, query } = to
      if (query.to === 'foo') {//åé¢åªè·Ÿ?to=fooçš„è·³åˆ°äº†foo
          return { path: '/foo', query: null }
      }
      if (hash === '#baz') {//hashå€¼ä¸ºbazçš„å®šå‘åˆ°äº†è¿™é‡Œ
          return { name: 'baz', hash: '' }
      }
      if (params.id) {
          return '/with-params/:id'//åªå¸¦IDçš„è·³åˆ°äº†è¿™ä¸ª
      } else {
          return '/bar'//ä»€ä¹ˆéƒ½æ²¡åŠ è·³åˆ°äº†è¿™ä¸ª
      }
  }
  ```

  

### åˆ«å

/a çš„åˆ«åæ˜¯ /bï¼Œæ„å‘³ç€ï¼Œå½“ç”¨æˆ·è®¿é—® /b æ—¶ï¼ŒURL ä¼šä¿æŒä¸º /bï¼Œä½†æ˜¯è·¯ç”±åŒ¹é…åˆ™ä¸º /aï¼Œå°±åƒç”¨æˆ·è®¿é—® /a ä¸€æ ·ã€‚
æ™®é€šå†™æ³•ï¼š
alias: '/foo'
å¤šåˆ«åå†™æ³•ï¼š
alias: ['/baz', 'baz-alias', '/baz-alias']





### è·¯ç”±å…ƒä¿¡æ¯

å®šä¹‰è·¯ç”±ï¼ˆå°±æ˜¯å†™routesä¸­ä¸pathåŒçº§çš„å±æ€§ï¼‰çš„æ—¶å€™å¯ä»¥é…ç½®metaå­—æ®µï¼ˆå¯¹è±¡ï¼‰ï¼Œmetaä¸­å¯ä»¥è®¾ç½®ä¸€çº§å¯¹è±¡ï¼Œå¯¹è±¡åä»£è¡¨éœ€è¦éªŒè¯çš„å‚æ•°ï¼Œå¯¹è±¡å€¼ç»è¿‡ifåˆ¤æ–­ä¸ºéçš„ä¸éªŒè¯ï¼Œifåˆ¤æ–­ä¸ºæ˜¯çš„éªŒè¯ã€‚
éªŒè¯æ ¼å¼ï¼š
router.beforeEach((to, from, next) => {
    if (to.matched.some(xx => xx.meta.requiresId)) {
        ...
    }//è¿™ä¸ªifåœ¨new VueRouterçš„scrollBehaviorå±æ€§ä¸­åŒæ ·é€‚ç”¨
}// requiresId åœ¨è·¯ç”±çš„metaä¸­å­˜åœ¨ã€æœ‰å€¼ä¸”å€¼ä¸ä¸ºåˆ¤æ–­ä¸ºâ€˜éâ€™çš„å€¼ï¼Œä¾‹å­ä¸­ifåˆ¤æ–­ä¼šè¿”å›trueï¼Œå…¶ä½™æƒ…å†µè¿”å›false

- metaçš„å±æ€§çš„å€¼å¯ä»¥æ˜¯å¯¹è±¡



# jsè¯­å¥ç¼–å†™



### ç¼–ç¨‹å¼çš„å¯¼èˆª

<span style='opacity:.5'>ä¸‹é¢çš„`router`ç”¨`vueç»„ä»¶å®ä¾‹.$router`ä¹Ÿæ˜¯ä¸€æ ·çš„</span>

[`router.push()`](https://router.vuejs.org/zh/guide/essentials/navigation.html#router-push-location-oncomplete-onabort)  
ï¼ˆğŸ‘†æ›´å¤šå†…å®¹è§æ–‡æ¡£ï¼‰

ä¸`<router-link :to="...">`æ•ˆæœä¸€è‡´  
å‚æ•°å¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–è€…å¯¹è±¡

- å­—ç¬¦ä¸²  
  è¿™ä¸ªå­—ç¬¦ä¸²æ˜¯pathï¼ˆå‰é¢è¦æœ‰`/`ï¼‰
- å¯¹è±¡  
  å¯ä»¥ä¾æ®nameè·³è½¬ï¼Œä¹Ÿå¯ä»¥ä¾æ®pathï¼Œè¿˜å¯ä»¥å¸¦queryæˆ–è€…paramsï¼ˆå¦‚metaç­‰å…¶ä»–å‚æ•°ä¼ äº†ä¹Ÿæ²¡æœ‰æ•ˆæœï¼‰



[`router.replace()`](https://router.vuejs.org/zh/guide/essentials/navigation.html#router-replace-location-oncomplete-onabort)

å®Œå…¨æ›¿æ¢å½“å‰å†å²è®°å½•ï¼Œä¸ç®¡å¦‚ä½•å‰è¿›åé€€å†æ‰§è¡Œè¿™ä¸ªæ–¹æ³•éƒ½ä¼šå®Œå…¨æ›¿æ¢æ‰å½“å‰çš„å†å²è®°å½•ï¼Œå¹¶ä¸”å¯¹å…¶ä»–å†å²è®°å½•æ²¡æœ‰ä»»ä½•å½±å“ã€‚`<router-link :to="..." replace>`ä¹Ÿæœ‰åŒæ ·æ•ˆæœã€‚



[`router.go(n)`](https://router.vuejs.org/zh/guide/essentials/navigation.html#router-go-n)

åœ¨å†å²è®°å½•ä¸­å‘å‰æˆ–è€…åé€€å¤šå°‘æ­¥ã€‚ã€çŸ¥é“è¿™äº›æ–¹æ³•æ€ä¹ˆæ‰§è¡Œåæµ‹è¯•ä¸€ä¸‹è¶…è´Ÿè·ä¼šæœ‰ä»€ä¹ˆç»“æœã€‘



### [å¯¼èˆªé’©å­](https://router.vuejs.org/zh/guide/advanced/navigation-guards.html)

ï¼ˆ[2018å¹´çš„æ–‡æ¡£](https://github.com/vuejs/vue-router/blob/ca2561f79345c136eccb146caaefe75d78f5855e/docs/zh/advanced/navigation-guards.md)å°±å·²ç»ç§°ä¸ºå¯¼èˆªå®ˆå«äº†ï¼‰

ç›¸å½“äºè·¯ç”±çš„ç”Ÿå‘½å‘¨æœŸé’©å­

æ³¨å†Œåˆ†ä¸‰ç§æƒ…å†µï¼šå…¨å±€ã€è·¯ç”±ç‹¬äº«ã€ç»„ä»¶ç‹¬äº«  

- å…¨å±€  
  - router.beforeEach((to, from, next)=>{})
    - ä¸€å®šè¦æ‰§è¡Œnextæ‰ä¼šå®Œæˆè·¯ç”±è·³è½¬  
    - å¦‚æœç»™nextçš„é…ç½®çš„nameå±æ€§å’Œ`to.name`ä¸€è‡´  
      é‚£ä¼šå¯¼è‡´æ— é™è·³è½¬ï¼Œæœ€ç»ˆé¡µé¢æŠ¥é”™`Maximum call stack size exceeded`

- [ç»„ä»¶ç‹¬äº«ï¼ˆç»„ä»¶å†…çš„å®ˆå«ï¼‰](https://router.vuejs.org/zh/guide/advanced/navigation-guards.html#%E7%BB%84%E4%BB%B6%E5%86%85%E7%9A%84%E5%AE%88%E5%8D%AB)  
  è¿™é‡Œè¯´çš„ç»„ä»¶å°±æ˜¯æ™®é€šçš„vueç»„ä»¶  

  - è§¦å‘æ—¶æœº
    - beforeRouteEnterã€beforeRouteLeave  
      ç»„ä»¶å› è·¯ç”±è€Œè¢«åˆ›å»ºã€é”€æ¯æ—¶ä¼šè§¦å‘
    - beforeRouteUpdate  
      ç½‘è¯´æ˜¯â€œè·¯ç”±æ”¹å˜ï¼Œä½†æ˜¯ç»„ä»¶å¤ç”¨â€æ—¶è§¦å‘ï¼Œä¸è¿‡ä¸ªäººæœªæµ‹è¿‡  
    - å¦‚æœç»„ä»¶ä¸æ˜¯router-viewä¸­å‡ºæ¥çš„  
      é‚£3ä¸ªé’©å­éƒ½ä¸ä¼šè§¦å‘

- æœ‰ä¸‰ä¸ªé’©å­ï¼šbeforeRouteEnterã€beforeRouteUpdateã€beforeRouteLeave ï¼Ÿï¼Ÿï¼Ÿ 
  
- beforeRouteEnterä¾‹å­ï¼š  ï¼Ÿï¼Ÿï¼Ÿ
  
    ```js
    mounted() {},
    beforeRouteEnter(to, from, next)  {
      debugger 
      next()
    },
    ```
    `to`ä»£è¡¨ä¸‹ä¸€ä¸ªè·¯ç”±ï¼Œ`from`æ˜¯è·³è½¬å‰è·¯ç”±ã€‚  
    åŠ ç‚¹åé¢å¯ä»¥è·Ÿä¸Š è·¯ç”±ä¿¡æ¯å¯¹è±¡å±æ€§ï¼Œå¹¶ä¸”å¯ä»¥æ‰“å°å‡ºæ¥ã€‚`query`å’Œ`params`å¯ä»¥å†ç‚¹ä¸‹ä¸€çº§å±æ€§ã€‚  
    é’©å­ä¸­ä¸€å®šè¦æœ‰`next()`æ‰ä¼šæ­£å¸¸åˆ°ä¸‹ä¸€æ­¥ï¼Œ`next(false)`å°±æ˜¯ä¸åˆ°ä¸‹ä¸€æ­¥ï¼ˆç›®å‰æµ‹è¯•ç»“æœå’Œä¸å†™`next()`æ²¡åŒºåˆ«ï¼‰ã€‚  
  `next()`ä¹Ÿå¯ä»¥ç”¨æ¥è·¯ç”±ï¼Œæœ‰ä¸¤ç§å†™æ³•ï¼š
  
    1. `next('/xx')` 
  2. `next({name:'xx'})`ã€‚
  
- è·¯ç”±åä¼šæ‰§è¡Œé‚£ä¸ªè·¯ç”±çš„é’©å­  
  ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰









- åœ¨$router.go(-1)æ— æ³•å›é€€æ—¶  
  å…¨å±€å®ˆå«éƒ½ä¸ä¼šè§¦å‘ï¼ˆå·²æµ‹è¿‡[å‰ç½®](https://router.vuejs.org/zh/guide/advanced/navigation-guards.html#%E5%85%A8%E5%B1%80%E5%89%8D%E7%BD%AE%E5%AE%88%E5%8D%AB)ã€[è§£æ](https://router.vuejs.org/zh/guide/advanced/navigation-guards.html#%E5%85%A8%E5%B1%80%E8%A7%A3%E6%9E%90%E5%AE%88%E5%8D%AB)ã€[åç½®](https://router.vuejs.org/zh/guide/advanced/navigation-guards.html#%E5%85%A8%E5%B1%80%E5%90%8E%E7%BD%AE%E9%92%A9%E5%AD%90)ï¼‰



##### åˆ¤æ–­æ˜¯å¦æ— æ³•å›é€€  

æ¢å¥è¯è¯´å°±æ˜¯ï¼šåˆ¤æ–­æ˜¯å¦å›é€€åˆ°åˆå§‹é¡µé¢

- ç›®å‰çš„åˆ¤æ–­æ–¹æ³•  

  ```js
  mounted(){
    this.$router.beforeEach ((to, from, next) => {
      this.isGoingBack=false
      next()
    })
  },
  methods:{
    goBack(){
      this.$router.go(-1)
      this.isGoingBack=true
      requestAnimationFrame(()=>{ // ç»è¿‡æµ‹è¯•ï¼š2ä¸ªrequestAnimationFrameä¼šæ¯”2ä¸ªsetTimoute0æˆ–è€…2ä¸ª$nextTicketæ›´é è°±
        requestAnimationFrame(()=>{
          if(this.isGoingBack){
            // åˆ°è¿™å°±è¯´æ˜æ— æ³•å›é€€äº†
            debugger
          }
        })
      })
    },
  },
  ```

  





# æ•ˆæœ





### è·¯ç”±åŠ¨æ•ˆ

å¯ä»¥æ•´ä½“è®¾ã€å•ä¸ªè·¯ç”±è®¾ç½®ã€æ ¹æ®'$route' (to, from)è®¾ç½®
https://router.vuejs.org/zh-cn/advanced/transitions.html





### æ»šåŠ¨è¡Œä¸º

new VueRouterä¸­çš„scrollBehaviorå±æ€§ï¼Œä¾‹å­ï¼š
scrollBehavior (to, from, savedPosition) {
    return { x: 222, y: 222 }//è·¯ç”±åæ»šåŠ¨æ¡æ»šåŠ¨åˆ°x222ï¼Œy222å¤„
}
ç”¨å˜é‡ä»£ç†çš„æ–¹æ³•ï¼š
    new VueRouterå¤„å†™ scrollBehavior:xx, // ä¹Ÿå¯ä»¥ç®€å†™ä¸º scrollBehavior, ä½†æ˜¯è¿™æ ·çš„è¯å˜é‡åå¿…é¡»æ˜¯scrollBehaviorã€‚ï¼ˆç®€å†™æ”¯æŒæ¥æºäºES6çš„ å¯¹è±¡å­—é¢å±æ€§å€¼ç®€å†™ ï¼‰
    å£°æ˜å¤„å†™ const xx = (to, from, savedPosition) => {...}
ä¸å¯åŠ¨scrollBehaviorçš„è¯ï¼Œç”¨æµè§ˆå™¨çš„å‰è¿›åé€€æŒ‰é’®ä¼šä¿å­˜æ¯ä¸ªå†å²è®°å½•ä¸­çš„æ»šåŠ¨ä½å­ï¼Œä¸è¿‡é€€å›åˆ°æ²¡æœ‰å¯åŠ¨è·¯ç”±çš„é‚£ä¸ªå†å²è®°å½•æ—¶ä¼šå‘ç”Ÿæ”¹å˜ï¼Œé‚£ä¸ªå†å²è®°å½•çš„ä¸‹ä¸€ä¸ªå†å²è®°å½•çš„æ»šåŠ¨ä½å­è®°å½•ä¼šè¢«æ¸…ç©ºã€‚
å¦‚æœåªæœ‰ä¾‹å­ä¸­çš„å†…å®¹çš„è¯ï¼Œå„å†å²è®°å½•ä¸­çš„æ»šåŠ¨ä½å­è®°å½•ä¼šå˜å¾—å¾ˆæ··ä¹±ï¼Œè¦æ‹¥æœ‰ä¹‹å‰æ»šåŠ¨ä½å­è®°å½•åŠŸèƒ½éœ€åŠ savedPositionçš„å­˜åœ¨åˆ¤æ–­ï¼Œå¦‚ä¸‹ï¼š
scrollBehavior (to, from, savedPosition) {
    if (savedPosition) {
        return savedPosition //æ ¹æ®æµ‹è¯•ï¼Œå†™falseæ›´å¥½
    } else {
        return { x: 0, y: 0 }
    }
}
è¦è·³è½¬åˆ°hashçš„é”šè®°ï¼š
if (to.hash) {
    return {
        selector: to.hash
    }
} // å¯ä»¥åŒæ—¶è¿”å›selectorå’Œxã€yï¼Œä¸‰è€…åŒæ—¶å­˜åœ¨çš„æƒ…å†µä¸‹æ ¹æ®selectorè·³è½¬







# ç¼ºé™·

- å­è·¯ç”±å¿…é¡»åœ¨çˆ¶è·¯ç”±é¡µé¢ä¸­æ¸²æŸ“  
  è¿™æ ·å°±å¯¼è‡´ï¼šå¦‚æœä¸€ä¸ªé¡µé¢å±äºå¦ä¸€ä¸ªé¡µé¢ï¼Œæ— æ³•åœ¨vue-routerä¸­ä½“ç°è¿™ä¸¤ä¸ªé¡µé¢çš„ä»å±å…³ç³»





# æœªå½’ç±»

- vue-routeræ¯æ¬¡è·³è½¬åˆ°ä¸€ä¸ªç»„ä»¶éƒ½ä¼šè§¦å‘ç»„ä»¶çš„`mounted`æ–¹æ³•  
  ç¦»å¼€ä¸€ä¸ªç»„ä»¶éƒ½ä¼šæ‰§è¡Œ`beforeDestroy`å’Œ`destroyed`æ–¹æ³•
  - [åœ¨åŒç»„ä»¶ä¸åŒè·¯ç”±é—´è°ƒæ•´æ—¶ä¸ä¼šè§¦å‘é’©å­](https://router.vuejs.org/zh/guide/essentials/dynamic-matching.html#%E5%93%8D%E5%BA%94%E8%B7%AF%E7%94%B1%E5%8F%82%E6%95%B0%E7%9A%84%E5%8F%98%E5%8C%96)
- è·¯ç”±é…ç½®ä¸­é…ç½®paramsä¸ç”Ÿæ•ˆï¼ˆç”¨router-linkã€router.pushå½¢å¼å¯ä»¥å¸¦ï¼‰  
  é…ç½®queryä¹Ÿåªèƒ½åŠ åˆ°pathé‡Œæ‰èƒ½ç”Ÿæ•ˆï¼ˆç”¨å±æ€§å½¢å¼ä¸ç”Ÿæ•ˆï¼‰  
  ç”¨å±æ€§å½¢å¼é…metaç”Ÿæ•ˆ   
  ï¼ˆè·¯ç”±é…ç½®æŒ‡çš„æ˜¯å®ä¾‹åŒ–`'vue-router'`æ—¶çš„`routes`å‚æ•°ï¼‰
- åˆ·æ–°é¡µé¢åparamså±…ç„¶è¿˜åœ¨
- [è·¯ç”±æ‡’åŠ è½½](https://router.vuejs.org/zh/guide/advanced/lazy-loading.html)  
  [è¿™ä¸ªåšå®¢ä¹Ÿå¯ä»¥çœ‹](https://blog.csdn.net/xm1037782843/article/details/88225104)  
  æ‡’åŠ è½½å¯ä»¥æŠŠé¡¹ç›®ä»ä¸€ä¸ªå¤§åŒ…æ‹†æˆä¸€ä¸ªé¡µé¢ä¸€ä¸ªåŒ…ï¼Œè¿›å…¥é¡µé¢æ—¶å†åŠ è½½é¡µé¢çš„åŒ…  
  - ä¸è¿‡åœ¨åŠ è½½è¿‡ç¨‹ä¸­ä¸ä¼šè·³åˆ°ç›¸åº”é¡µé¢ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•ååº”  
    - è§£å†³åŠæ³•ï¼š  
      ç©ºç™½æ—¶é—´ä¹Ÿå°±æ˜¯beforeEachå’ŒafterEachä¹‹é—´çš„æ—¶é—´  
      å¯ä»¥é€šè¿‡è¿™ä¸ªç‰¹æ€§åŠ ä¸ŠåŠ è½½æ•ˆæœ




## 重构地图接入方式的笔记

- world的中心在经纬度00点


## GeoGL可优化空间

- 许多方法在多个组件重复出现

  如：显隐组件、批量偏移子项、数据源解析

- 错误统一处理

- 将“app”放在框架内部而不是让用户自己`new`  

  这样就不必等`addTo`结束后才能获取“app”，组件嵌套的情况也能更方便地获取“app”
  
- setUrl时不会走addTo要注意

- 高亮线变色

  - 多线程
  - 内存释放
  - 精准测试异步执行的同步代码是否会阻塞（不会阻塞的话则可以在处理数据的同时保持动画效果）

##  GeoGL

- 打包：

  build-auth-lan内网、build-auth-wan外网  

  然后把“1.0.27”文件夹压缩成zip文件

- 思极纬度偏移并不是按真实地球（赤道突出的椭圆）来的  

  有可能是相反的（南北极突出）   

- **坐标系**  
  ![](..\图片\GeoGL坐标系.png)

- 缩放  

  `scale`要放`setTimeout 0`里，不然会被覆盖

- 高性能开关记录

  **关闭**
  不看 4 44
  看 1 39

  **开启**
  不看 4 44
  看 1 32
  
- 彗星性能记录

  慧尾顶点数量  帧率  情况

  - 720  41-44  普通彗星一颗
  - 3600  39-42  普通彗星一实例五颗
  - 3360  36-38  普通彗星多实例
  - 3000  31-32  彗星轨道一实例多轨道

- 对于不符合条件的传参，也要让程序能合理执行

## 待研究内容

- tween
  - 研究下tween的版本与相关资料
  - 下载tween
- 光照
- 真正的光晕（雾）
- 不开`depthTest`无法正常显示的问题
- 旋转rotation、lookAt、四元数

## 性能测试

多立方体，总顶点20w，全显示21帧，显示800左右个顶点60帧

多立方体，总顶点200w，全显示2帧，显示32个顶点10帧

100个多顶点缓冲mesh，总顶点1.2kw，全显示35帧，显示部分60帧

200个多顶点缓冲mesh，总顶点2.4kw，全显示22帧，显示部分60帧

## tween

- `TWEEN.update(时间)`这个方法就算传入准确的时间差会延迟开始（时间差是指当前时间到第一次调用`update`之间的时间差）  

  延迟时间不定  
  
  而且在性能极限情况下会出现数值闪动  
  
  彗星组件中一个实例超过两个彗星也会无法开始
  
- 在从一个`TWEEN.Tween`实例到另一个实例的那一帧  

  会按顺序执行两个实例的`onUpdate`  

- 多次调用  

  - `to`  

    `onUpdate`不会重叠执行  

    在没有`stop`的情况下会时间跳跃（解决方案：同一帧内`stop`后`to`后`start`）  

  - `start`  

    `onUpdate`会重叠执行

- “TWEEN.Tween实例”的`stop`  

  会按顺序触发其`chain`链上的`onStop` （https://cdnjs.cloudflare.com/ajax/libs/tween.js/16.3.5/Tween.min.js）
  
- 一个“TWEEN.Tween实例”的`onComplete`里无法调用自己的`start`bug  （17.3.5的"src/Tween.js"会）（https://cdnjs.cloudflare.com/ajax/libs/tween.js/16.3.5/Tween.min.js的不会）

  允许调用的方法：将`start`放进`setTimeout 0`内
  
- 获取正在运行的tween实例

  `TWEEN.getAll()`

  返回一个数组

- 回调没有队列

  已测试：`onComplete`

## jsdoc

- **序号后无空行bug**  

  在序号后加一行空行并加一行`<i></i>`即可
  

## 进度记录

- 看到
“context.arc”——掘金博客
“Math.random(), Math.random(), Math.random(), 1,”
- RPC failed; curl 56 OpenSSL SSL_read: SSL_ERROR_SYSCALL, errno 10054
  fatal: The remote end hung up unexpectedly
  fatal: early EOF
  fatal: index-pack failed


# UAP
- 找工作空间地址
  MAIN/WebContent/WEB-INF/configuration/policy.cml里点module-repository
- 引入检出后的模块，也是点上面的东西，加上module，然后module里写上模块名
- Apache Tomcat v6.0（不知道哪开的）  => Open launch configuration => Arguments => VM arguments末尾加一行`-Xms1024M -Xmx1024M -XX:PermSize=256M -XX:MaxNewSize=256M -XX:MaxPermSize=256M`

## 思极地图

- **Marker**  
  - 如果`offset`写`[]`会导致dom元素固定在左上角（虽然官方文档就是这么写）
  - **显隐**  
    `remove`和`addTo(地图)`  
    对dom的改变在显隐后还会存留  
    在dom隐藏期间也可以对dom进行操作  